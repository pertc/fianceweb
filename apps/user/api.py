from rest_framework import viewsetsfrom rest_framework.decorators import list_routefrom core.decorator.response import Core_connectorfrom utils.exceptions import PubErrorCustomfrom apps.user.models import Users,Token,Login,UserDetailfrom apps.user.serializers import UsersSerializer,UsersDetailSerializerclass UserAPIView(viewsets.ViewSet):    @list_route(methods=['POST'])    @Core_connector(transaction=True,serializer_class=UsersSerializer,model_class=Users)    def register(self, request,*args,**kwargs):        serializer = kwargs.pop('serializer')        isinstance=serializer.save()        token=Token.objects.create(userid=isinstance.userid)        header={"Authorization": token.key}        data={            "userid": token.userid,            "mobile": isinstance.mobile,            "username": isinstance.username,            "passwd": isinstance.passwd,        }        return {"data":data,"header":header,"msg":"注册成功！"}    @list_route(methods=['POST'])    @Core_connector(transaction=True)    def login(self, request, *args, **kwargs):        userlogin=Login()        userlogin.mobile=self.request.data.get('mobile')        try:            user=Users.objects.get(mobile=userlogin.mobile)        except Users.DoesNotExist:            raise PubErrorCustom("手机号错误！")        if user.passwd != self.request.data.get('passwd'):            raise PubErrorCustom("密码错误！")        userlogin.save()        token = Token.objects.create(userid=user.userid)        header = {"Authorization": token.key}        data = {            "userid": token.userid,            "mobile": user.mobile,            "username": user.username,            "passwd": user.passwd,        }        return {"data": data, "header": header,"msg":"登录成功！"}class UserDetails(viewsets.ViewSet):    @Core_connector(transaction=True, serializer_class=UsersDetailSerializer, model_class=UserDetail)    def create(self,request,*args,**kwargs):        serializer = kwargs.pop('serializer')        serializer.save()        return None